#!/usr/bin/env python
# encoding: utf-8
"""
comparisonPlots.py

Created by hendrik on 2006-05-26.
Copyright (c) 2006 __MyCompanyName__. All rights reserved.
"""
from __future__ import division
from pylab import *
from scipy import *
import cPickle
import math
from plotSMCsamples import *
from GridUtilityPdf import GridUtilityPdf
import muellerSampler
import sys

dataset4  =  [
		['runs/100parts_509iter_10stepsize_AdamAndArnaudsAlgorithm3_LinearFractionalSchedule.pydata',
		 "Adam and Arnaud's algorithm 3"],
		['runs/100parts_509iter_10stepsize_AdamAndArnaudsAlgorithm3_IntegerStepsSchedule.pydata',
		 "Integer steps"],
		['runs/100parts_509iter_10stepsize_PtoPlogPAnnealingSMCSampler_Fractional0to1Schedule.pydata',
		 "New annealing scheme"]
	]

indices = xrange(sys.maxint)
def Indexed(sequence):
	return zip(sequence, indices)


def loadAllData(data):
	for d in data:
		d.append(loadData(d[0]))
	return data

def getSpecificAvgSampleLikelihoodValues(alltheData, desired_n_t, gridPdf):
	avgSampleLikelihoods = []
	for d in alltheData:
		dataSet = d[2]
		index = argmax( array(dataSet['n_tStore']) == desired_n_t)
		particles = dataSet['sampleStore'][index]
		value = computeAvgSampleLikelihood(particles, desired_n_t, gridPdf)
		avgSampleLikelihoods.append(value)
	return avgSampleLikelihoods
		
	
def plotSpecificIntegerHistogram(dataSet, desired_n_t):
	index = argmax( array(dataSet['n_tStore']) == desired_n_t)
	print "the index at which n_t = " ,desired_n_t, " is " , index
	particles = dataSet['sampleStore'][index]
	muellerSampler.plotHist(particles,100,-2.0, 2.0)
	
def compareHistograms(alltheData, desired_n_t, gridPdf):
	numPlots = len(alltheData) + 1
	figure()
	grid = linspace(-1.99, 1.99, 2000)
	gridEvals = array([gridPdf.evaluate(v,desired_n_t) for v in grid])
	subplot(numPlots, 1, 1)
	plot(grid, gridEvals)
	title('Grid evaluations')
	for d, i in Indexed(alltheData):
		subplot(numPlots, 1, i+2)
		plotSpecificIntegerHistogram(d[2], desired_n_t)
		title(d[1])
	

def comparitivePlots(alltheData, plotFct):
	numPlots = len(alltheData)
	figure()
	for d, i in Indexed(alltheData):
		subplot(numPlots, 1, i+1)
		plotFct(d[2])
		title(d[1])
	
def main():
	evalExponent = 50
	gridPdf = GridUtilityPdf()
	alltheData = loadAllData(dataset4)
	comparativeAvgLikelihoodValues = getSpecificAvgSampleLikelihoodValues(alltheData, evalExponent, gridPdf)
	for i in xrange(len(alltheData)):
		print alltheData[i][1], " at n_t = ", evalExponent, ": ", comparativeAvgLikelihoodValues[i]
	comparitivePlots(alltheData, plotESSLog)
	comparitivePlots(alltheData, pointPlots)
	comparitivePlots(alltheData, plotIncrementalWeightVariances)
	compareHistograms(alltheData, evalExponent, gridPdf)
	show()

if __name__ == '__main__':
    main()

